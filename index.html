<script>
let active = false;
let mode = "Calm";
let memory = [];
let currentGoal = null;

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const modeLabel = document.getElementById("mode");

/* ===== DISPLAY ===== */
function add(text, who) {
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ===== MEMORY ===== */
function remember(entry) {
  memory.push(entry);
  if (memory.length > 12) memory.shift();
}

/* ===== UNDERSTANDING ===== */
function intent(text) {
  if (text.includes("?")) return "question";
  if (text.startsWith("analyze") || text.startsWith("explain")) return "analysis";
  if (text.startsWith("build") || text.startsWith("make") || text.startsWith("do")) return "goal";
  if (text.startsWith("activate") || text.startsWith("run")) return "command";
  return "statement";
}

/* ===== CONFIDENCE CHECK ===== */
function confidentEnough(intentType) {
  if (intentType === "question" && !currentGoal) return false;
  if (intentType === "analysis" && !currentGoal) return false;
  return true;
}

/* ===== SMART RESPONSE ENGINE ===== */
function think(text) {
  const type = intent(text);

  // Identity
  if (text.includes("your name")) {
    return "I am Titan. A reasoning and command system.";
  }

  if (text.includes("who am i")) {
    return "You are my creator and operator.";
  }

  // Goal setting
  if (type === "goal") {
    currentGoal = text;
    return "Goal registered. What is the desired outcome?";
  }

  // Not confident â†’ ask smart question
  if (!confidentEnough(type)) {
    return "I need more context before answering. What are you trying to achieve?";
  }

  // Analysis
  if (type === "analysis") {
    return "Breaking this down logically. What constraint matters most?";
  }

  // Commands
  if (type === "command") {
    return "Command acknowledged. Provide parameters.";
  }

  // Statements
  if (mode === "Analyst") {
    return "Noted. How does this affect the current goal?";
  }

  if (mode === "Combat") {
    return "Acknowledged. Awaiting actionable directive.";
  }

  return "Understood. Continue.";
}

/* ===== MAIN ===== */
function send() {
  const text = input.value.trim();
  if (!text) return;
  input.value = "";

  add("You: " + text, "you");
  const lower = text.toLowerCase();

  // Wake
  if (!active) {
    if (lower.includes("hey titan")) {
      active = true;
      add("Titan online. Systems synchronized.", "titan");
    } else {
      add("Titan offline. Say 'hey titan' to activate.", "titan");
    }
    return;
  }

  // Modes
  if (lower.includes("calm mode")) {
    mode = "Calm";
    modeLabel.innerText = "Mode: Calm";
    add("Calm mode engaged.", "titan");
    return;
  }

  if (lower.includes("analyst mode")) {
    mode = "Analyst";
    modeLabel.innerText = "Mode: Analyst";
    add("Analyst mode engaged.", "titan");
    return;
  }

  if (lower.includes("combat mode")) {
    mode = "Combat";
    modeLabel.innerText = "Mode: Combat";
    add("Combat mode engaged.", "titan");
    return;
  }

  // Smart response
  const reply = think(lower);
  add(reply, "titan");
  remember({ user: text, goal: currentGoal });
}

/* Enter key */
input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});
</script>
