<script>
let active = false;
let mode = "Calm";
let memory = [];

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const modeLabel = document.getElementById("mode");

/* ===== CORE UTILS ===== */
function add(text, who) {
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function remember(entry) {
  memory.push(entry);
  if (memory.length > 25) memory.shift();
}

/* ===== UNDERSTANDING ===== */
function classify(text) {
  if (text.includes("?")) return "question";
  if (text.startsWith("analyze") || text.startsWith("explain")) return "analysis";
  if (text.startsWith("do ") || text.startsWith("activate") || text.startsWith("run")) return "command";
  if (text.length < 4) return "noise";
  return "statement";
}

/* ===== REASONING ENGINE ===== */
function think(text) {
  const intent = classify(text);

  // Identity
  if (text.includes("your name")) {
    return "I am Titan. A system built to assist, analyze, and respond with intent.";
  }

  if (text.includes("who am i")) {
    return "You are my creator and primary operator.";
  }

  // Analysis
  if (intent === "analysis") {
    return "To analyze properly, I need the subject and what outcome you want.";
  }

  // Questions
  if (intent === "question") {
    return "That question depends on context. What decision are you trying to make?";
  }

  // Commands
  if (intent === "command") {
    return "Command recognized. Specify parameters or constraints.";
  }

  // Statements
  if (intent === "statement") {
    if (mode === "Analyst") {
      return "Noted. How does this information connect to your objective?";
    }
    if (mode === "Combat") {
      return "Acknowledged. Awaiting actionable directive.";
    }
    return "Understood. Continue.";
  }

  return "Input unclear. Rephrase.";
}

/* ===== MAIN FLOW ===== */
function send() {
  const text = input.value.trim();
  if (!text) return;
  input.value = "";

  add("You: " + text, "you");
  const lower = text.toLowerCase();

  // Wake
  if (!active) {
    if (lower.includes("hey titan")) {
      active = true;
      add("Titan online. Systems ready.", "titan");
    } else {
      add("Titan offline. Say 'hey titan' to activate.", "titan");
    }
    return;
  }

  // Modes
  if (lower.includes("calm mode")) {
    mode = "Calm";
    modeLabel.innerText = "Mode: Calm";
    add("Calm mode engaged.", "titan");
    return;
  }

  if (lower.includes("analyst mode")) {
    mode = "Analyst";
    modeLabel.innerText = "Mode: Analyst";
    add("Analyst mode engaged. Logical processing prioritized.", "titan");
    return;
  }

  if (lower.includes("combat mode")) {
    mode = "Combat";
    modeLabel.innerText = "Mode: Combat";
    add("Combat mode engaged. Tactical focus online.", "titan");
    return;
  }

  // Smart response
  const reply = think(lower);
  add(reply, "titan");
  remember({ you: text, titan: reply });
}

/* Enter key */
input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});
</script>
